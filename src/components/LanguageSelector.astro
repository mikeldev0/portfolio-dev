---
import LanguageArrowIcon from "../icons/LanguageArrowIcon.astro";
// Obtener el idioma actual desde localStorage o por defecto 'en'
let currentLang = 'en';
if (typeof window !== 'undefined') {
  currentLang = localStorage.getItem('language') ?? 'en';
}
// Cargar los nombres de los idiomas desde el archivo de localización correspondiente
let languageNames: Record<string, string> = {};
try {
  languageNames = await import(`../../public/locales/${currentLang}.json`).then(m => m.languageNames);
} catch (e) {
  languageNames = {
    en: "English",
    es: "Español",
    fr: "Français",
    de: "Deutsch",
    it: "Italiano"
  };
}
const LANGUAGES = [
    { code: "en" },
    { code: "es" },
    { code: "fr" },
    { code: "de" },
    { code: "it" },
];
---
<div class="ml-2 relative hover:scale-105 transition duration-200 ease-in-out">
    <select
        id="language-selector"
        class="appearance-none bg-transparent text-gray-800 dark:text-gray-200 text-xs md:text-sm px-2 py-2 pr-6 rounded-md hover:text-purple-500 dark:hover:text-purple-400 focus:outline-none cursor-pointer "
    >
        {LANGUAGES.map(lang => <option value={lang.code}>{languageNames[lang.code]}</option>)}
    </select>
    <LanguageArrowIcon />
</div>

<script is:inline>
    const LANGUAGES = [
        { code: "en" },
        { code: "es" },
        { code: "fr" },
        { code: "de" },
        { code: "it" },
    ];
    const languageSelector = document.getElementById("language-selector");

    function getLanguagePreference() {
        if (typeof localStorage !== "undefined") {
            return localStorage.getItem("language") ?? "en";
        }
        return "en";
    }
    function setLanguagePreference(code) {
        localStorage.setItem("language", code);
    }
    function updateSelectedLanguage() {
        const code = getLanguagePreference();
        languageSelector.value = code;
    }
    updateSelectedLanguage();

    languageSelector.addEventListener("change", (e) => {
        const code = e.target.value;
        setLanguagePreference(code);
        window.location.reload(); // recargar para aplicar el idioma
    });
</script>
